<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>為 Blog 加入文章大綱功能</title>
      <link href="/2023/12/28/toc-plugin-make/"/>
      <url>/2023/12/28/toc-plugin-make/</url>
      
        <content type="html"><![CDATA[<h1 id="Credit"><a href="#Credit" class="headerlink" title="Credit"></a>Credit</h1><blockquote><p>使用、參考的網路資源 :<br><a href="https://github.com/bubkoo/hexo-toc">https://github.com/bubkoo/hexo-toc</a><br><a href="https://yscoder.github.io/20150514/hexo-toc.html">https://yscoder.github.io/20150514/hexo-toc.html</a><br><a href="https://developer.mozilla.org/en-US/">https://developer.mozilla.org/en-US/</a></p></blockquote><p>對於提供資源的作者們，在此表示感謝，如果資源的使用有任何不當之處，請來信告知我。<br>I sincerely express my gratitude to the authors who have provided resources. If there is any inappropriate use of the resources, please inform me by email.<br><strong>email</strong> : <a href="mailto:&#116;&#x61;&#x6e;&#x69;&#109;&#x61;&#x6c;&#x31;&#x39;&#x31;&#50;&#x40;&#103;&#x6d;&#x61;&#x69;&#x6c;&#x2e;&#x63;&#x6f;&#109;">&#116;&#x61;&#x6e;&#x69;&#109;&#x61;&#x6c;&#x31;&#x39;&#x31;&#50;&#x40;&#103;&#x6d;&#x61;&#x69;&#x6c;&#x2e;&#x63;&#x6f;&#109;</a></p><hr><h1 id="前言廢話"><a href="#前言廢話" class="headerlink" title="前言廢話"></a>前言廢話</h1><p>⚠️ 本文技術含量 &#x3D;&#x3D; 0<br>🐰 程式碼 : <a href="https://github.com/Tanimal19/Blog-Plugin/tree/main">github</a></p><p>接續上一篇的搜尋功能，這次要幫網站加入大綱(table of content)功能。<br>有時候遇到那種內容很多、又沒有大綱的文章，就覺得要一直上下滑動很麻煩，所以我覺得大綱功能應該是每個網站必備的吧(主觀想法)。<br>同樣的，這個大綱功能也是一台拼裝車，如果可以的話直接去上方參考資源看或許對學習比較有幫助?</p><hr><h1 id="some-HTML"><a href="#some-HTML" class="headerlink" title="some HTML"></a>some HTML</h1><p>首先決定大綱的架構是什麼樣子，具體而言，我只想讓大綱顯示<strong>一級標題</strong>和<strong>二級標題</strong>就好，不然變得太長就沒有大綱的意義了。<br>用無序列表來表示，每一個項目包含標題的內容、連到該標題的超連結，還有其下一層的標題列表。以<a href="https://tanimal19.github.io/2023/11/17/toc-test/">這篇文章</a>為例，(經過 javascript 加工後)大綱應該會長這樣 :</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;toc&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#header-1-1&quot;</span> <span class="attr">class</span>=<span class="string">&quot;toc-link level1 active reach&quot;</span>&gt;</span>header 1.1<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#header-2-1&quot;</span> <span class="attr">class</span>=<span class="string">&quot;toc-link level2&quot;</span>&gt;</span>header 2.1<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#header-2-2&quot;</span> <span class="attr">class</span>=<span class="string">&quot;toc-link level2&quot;</span>&gt;</span>header 2.2<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#header-1-2&quot;</span> <span class="attr">class</span>=<span class="string">&quot;toc-link level1&quot;</span>&gt;</span>header 1.2<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#header-1-3&quot;</span> <span class="attr">class</span>=<span class="string">&quot;toc-link level1&quot;</span>&gt;</span>header 1.3<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#header-2-1-1&quot;</span> <span class="attr">class</span>=<span class="string">&quot;toc-link level2 hidden&quot;</span>&gt;</span>header 2.1<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#header-2-2-1&quot;</span> <span class="attr">class</span>=<span class="string">&quot;toc-link level2 hidden&quot;</span>&gt;</span>header 2.2<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>知道了我們要的大綱長怎樣，接下來就要利用 JavaScript 讓瀏覽器可以把大綱「生」出來。</p><hr><h1 id="some-JavaScript"><a href="#some-JavaScript" class="headerlink" title="some JavaScript"></a>some JavaScript</h1><h2 id="獲取文章內標題"><a href="#獲取文章內標題" class="headerlink" title="獲取文章內標題"></a>獲取文章內標題</h2><p>接下來，要利用 JS 來讓瀏覽器可以把大綱「生」出來。<br>首先，我們需要獲取文章中的每一個<strong>一級標題</strong>和<strong>二級標題</strong> :</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> headers = <span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&#x27;.e-content h1, .e-content h2&#x27;</span>);</span><br></pre></td></tr></table></figure><p>有可能這篇文章根本沒有<strong>一級標題</strong>和<strong>二級標題</strong>，這時候我們就不需要顯示出大綱，也不用跑接下來的程式 :</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(headers.<span class="property">length</span> == <span class="number">0</span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> wrap = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;toc-wrap&#x27;</span>);</span><br><span class="line">    wrap.<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&#x27;hidden&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="產生-html-元素"><a href="#產生-html-元素" class="headerlink" title="產生 html 元素"></a>產生 html 元素</h2><p>老實說，這部分的程式邏輯不太好解釋，我感覺應該可以用更精簡的方式寫出來，但我不會。<br>要解釋邏輯有點麻煩，自行去看看程式碼應該比聽我亂講還要更容易理解。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">headers.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">header</span>) &#123;</span><br><span class="line">    <span class="comment">// make link for header</span></span><br><span class="line">    <span class="keyword">var</span> link = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">    link.<span class="property">textContent</span> = header.<span class="property">textContent</span>;</span><br><span class="line">    link.<span class="property">href</span> = <span class="string">&#x27;#&#x27;</span> + header.<span class="property">id</span>;</span><br><span class="line">    link.<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&#x27;toc-link&#x27;</span>);</span><br><span class="line">    tocLinks.<span class="title function_">push</span>(link);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> subItem = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;li&#x27;</span>);</span><br><span class="line">    subItem.<span class="title function_">appendChild</span>(link);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> level = <span class="built_in">parseInt</span>(header.<span class="property">tagName</span>.<span class="title function_">charAt</span>(<span class="number">1</span>));</span><br><span class="line">    <span class="keyword">if</span>(level === <span class="number">1</span>)&#123;</span><br><span class="line">      <span class="keyword">if</span>(prevLevel &lt; <span class="number">1</span>)&#123;</span><br><span class="line">        curLevel1 = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;ul&#x27;</span>);</span><br><span class="line">        prevItem.<span class="title function_">appendChild</span>(curLevel1);</span><br><span class="line">      &#125;</span><br><span class="line">      link.<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&#x27;level1&#x27;</span>);</span><br><span class="line">      curLevel1.<span class="title function_">appendChild</span>(subItem);</span><br><span class="line"></span><br><span class="line">      prevLevel = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(level === <span class="number">2</span>)&#123;</span><br><span class="line">      <span class="keyword">if</span>(prevLevel &lt; <span class="number">2</span>)&#123;</span><br><span class="line">        curLevel2 = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;ul&#x27;</span>);</span><br><span class="line">        prevItem.<span class="title function_">appendChild</span>(curLevel2);</span><br><span class="line">      &#125;</span><br><span class="line">      link.<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&#x27;level2&#x27;</span>);</span><br><span class="line">      link.<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&#x27;hidden&#x27;</span>);</span><br><span class="line">      curLevel2.<span class="title function_">appendChild</span>(subItem);</span><br><span class="line"></span><br><span class="line">      prevLevel = <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    prevItem = subItem;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>總而言之，跑起來是沒問題的，所以就這樣吧</p><h2 id="點擊時滾動到標題位置"><a href="#點擊時滾動到標題位置" class="headerlink" title="點擊時滾動到標題位置"></a>點擊時滾動到標題位置</h2><p>點擊大綱時我不希望是直接跳過去，而是要平滑的滾動到該標題所在位置，這樣比較酷，所以我們要更改超連結元素被點擊時的預設行為 :</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">link.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span><br><span class="line">    event.<span class="title function_">preventDefault</span>();</span><br><span class="line">    <span class="keyword">var</span> targetId = <span class="variable language_">this</span>.<span class="title function_">getAttribute</span>(<span class="string">&#x27;href&#x27;</span>).<span class="title function_">substring</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">var</span> targetElement = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(targetId);</span><br><span class="line">    targetElement.<span class="title function_">scrollIntoView</span>(&#123; <span class="attr">behavior</span>: <span class="string">&#x27;smooth&#x27;</span> &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>簡單來說，<code>event.preventDefault()</code>會阻止原本超連結的點擊行為，也就是跳轉頁面。<br>接著獲取該超連結元素的id <code>targetId</code> (去掉連結裡面的<code>#</code>)，並在頁面內尋找對應元素，滾動到該元素的位置。</p><h2 id="highlight-當前位置"><a href="#highlight-當前位置" class="headerlink" title="highlight 當前位置"></a>highlight 當前位置</h2><p>我希望可以讓目前所在標題被 highlight，透過檢測目前頁面滾動到哪個位置，再和每個標題元素的位置做比較，來確認我們目前在哪個標題下方。<br>並且幫目前所在的<strong>二級標題</strong>(或<strong>一級標題</strong>)加上屬性 <code>active</code>，還有該標題所屬的<strong>一級標題</strong>加上屬性 <code>reach</code> :</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> scrollPosition = <span class="variable language_">window</span>.<span class="property">scrollY</span> || <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">scrollTop</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* at page&#x27;s top */</span></span><br><span class="line"><span class="keyword">if</span> (scrollPosition === <span class="number">0</span>) &#123;</span><br><span class="line">    tocLinks.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">link</span>) &#123;</span><br><span class="line">        link.<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">&#x27;active&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (link.<span class="property">classList</span>.<span class="title function_">contains</span>(<span class="string">&#x27;level1&#x27;</span>)) &#123;</span><br><span class="line">            link.<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">&#x27;reach&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* at page&#x27;s bottom */</span></span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (scrollPosition + <span class="variable language_">window</span>.<span class="property">innerHeight</span> &gt;= <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">scrollHeight</span> - <span class="number">5</span>) &#123;</span><br><span class="line">    tocLinks.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">link</span>) &#123;</span><br><span class="line">        link.<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">&#x27;active&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    tocLinks[tocLinks.<span class="property">length</span>-<span class="number">1</span>].<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&#x27;active&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* under some header */</span></span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    headers.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">header, index</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">Top</span> = header.<span class="property">offsetTop</span> + nav.<span class="property">offsetHeight</span> - <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (scrollPosition &gt; <span class="title class_">Top</span>) &#123;</span><br><span class="line">            tocLinks.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">link</span>) &#123;</span><br><span class="line">                link.<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">&#x27;active&#x27;</span>);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (tocLinks[index].<span class="property">classList</span>.<span class="title function_">contains</span>(<span class="string">&#x27;level1&#x27;</span>)) &#123;</span><br><span class="line">                    link.<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">&#x27;reach&#x27;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            tocLinks[index].<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&#x27;active&#x27;</span>);</span><br><span class="line">            <span class="keyword">if</span> (tocLinks[index].<span class="property">classList</span>.<span class="title function_">contains</span>(<span class="string">&#x27;level1&#x27;</span>)) &#123;</span><br><span class="line">                tocLinks[index].<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&#x27;reach&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="自動收合／展開"><a href="#自動收合／展開" class="headerlink" title="自動收合／展開"></a>自動收合／展開</h2><p>為了確保大綱不會太長，我只需要展示所有的<strong>一級標題</strong>以及當前位置的<strong>二級標題</strong>就好。<br>只要當前的<strong>一級標題</strong>沒有包含屬性 <code>reach</code>，也就是目前不在這個標題底下，我們就把這個<strong>一級標題</strong>底下的所有<strong>二級標題</strong>都加上屬性 <code>hidden</code>，也就是隱藏起來；否則就把底下的所有<strong>二級標題</strong>都移除屬性 <code>hidden</code>。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">tocLinks.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">link</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (link.<span class="property">classList</span>.<span class="title function_">contains</span>(<span class="string">&#x27;level1&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">var</span> linkWrap = link.<span class="property">parentElement</span>;</span><br><span class="line">        <span class="keyword">var</span> childlist = linkWrap.<span class="title function_">querySelectorAll</span>(<span class="string">&#x27;.level2&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (link.<span class="property">classList</span>.<span class="title function_">contains</span>(<span class="string">&#x27;reach&#x27;</span>)) &#123;</span><br><span class="line">            childlist.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">child</span>) &#123;</span><br><span class="line">                child.<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">&#x27;hidden&#x27;</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            childlist.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">child</span>) &#123;</span><br><span class="line">                child.<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&#x27;hidden&#x27;</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h1 id="some-CSS"><a href="#some-CSS" class="headerlink" title="some CSS"></a>some CSS</h1><p>最後就是單純的外觀設置，我是根據網站的主題 Vivia 來做配置的，所以就不多贅述。<br>要額外提的是我們要對具備屬性 <code>hidden</code> 的元素做隱藏，也就是將高度設為零 :</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.hidden</span></span><br><span class="line">  <span class="attribute">height</span>: <span class="number">0</span></span><br><span class="line">  opacity: <span class="number">0</span></span><br></pre></td></tr></table></figure><p>這篇文章大概就這樣，其實還可以講得更詳細，但我懶得ㄉㄚ</p>]]></content>
      
      
      <categories>
          
          <category> Blog </category>
          
      </categories>
      
      
        <tags>
            
            <tag> guide </tag>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>為 Blog 加入搜尋功能</title>
      <link href="/2023/11/19/search-plugin-make/"/>
      <url>/2023/11/19/search-plugin-make/</url>
      
        <content type="html"><![CDATA[<h1 id="Credit"><a href="#Credit" class="headerlink" title="Credit"></a>Credit</h1><blockquote><p>使用、參考的網路資源 :<br><a href="https://github.com/wzpan/hexo-generator-search">https://github.com/wzpan/hexo-generator-search</a><br><a href="https://liam.page/2017/09/21/local-search-engine-in-Hexo-site/">https://liam.page/2017/09/21/local-search-engine-in-Hexo-site/</a><br><a href="https://developer.mozilla.org/en-US/">https://developer.mozilla.org/en-US/</a></p></blockquote><p>對於提供資源的作者們，在此表示感謝，如果資源的使用有任何不當之處，請來信告知我。<br>I sincerely express my gratitude to the authors who have provided resources. If there is any inappropriate use of the resources, please inform me by email.<br><strong>email</strong> : <a href="mailto:&#116;&#97;&#x6e;&#x69;&#x6d;&#97;&#x6c;&#49;&#x39;&#x31;&#x32;&#x40;&#103;&#x6d;&#x61;&#105;&#108;&#x2e;&#99;&#x6f;&#x6d;">&#116;&#97;&#x6e;&#x69;&#x6d;&#97;&#x6c;&#49;&#x39;&#x31;&#x32;&#x40;&#103;&#x6d;&#x61;&#105;&#108;&#x2e;&#99;&#x6f;&#x6d;</a></p><hr><h1 id="前言廢話"><a href="#前言廢話" class="headerlink" title="前言廢話"></a>前言廢話</h1><p>⚠️ 本文技術含量 &#x3D;&#x3D; 0<br>🐰 程式碼 : <a href="https://github.com/Tanimal19/Blog-Plugin/tree/main">github</a></p><p>這應該算是這個網站的第一篇正式文章吧 (*´▽&#96;*)<br>做為一個前端初學者，要做站內搜尋還真不知從哪裡下手，還好網路資源很多(還有chatGPT)，我最後還是把這個功能做(拼裝)出來了。</p><hr><h1 id="some-HTML"><a href="#some-HTML" class="headerlink" title="some HTML"></a>some HTML</h1><p>一個基礎搜尋功能的架構應該會長這樣 :</p><ul><li><p><strong>可以輸入文字的搜尋框</strong> <code>search-input</code></p></li><li><p><strong>清除搜尋內容的按鈕</strong> <code>clear-btn</code></p></li><li><p><strong>搜尋按鈕</strong> <code>search-btn</code><br>這個按鈕其實沒有搜尋功能，只是讓搜尋框出現而已</p></li><li><p><strong>包住所有元素的外殼</strong> <code>search-box</code><br>整個搜尋功能我是打算做在 navbar 裡面，所以以上這些元素都會被包在 navbar 裡面</p></li><li><p><strong>搜尋結果</strong> <code>search-result</code><br>搜尋結果其實也可以讓它出現在另一個新分頁，可以顯示更多搜尋結果，但這感覺很麻煩，所以我決定讓結果出現在 navbar 下面就好 (注意不是包在 navbar 裡面)</p></li></ul><p>程式碼 :</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">navbar</span> <span class="attr">id</span>=<span class="string">&quot;navbar&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">nav</span> <span class="attr">id</span>=<span class="string">&quot;sub-nav&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;search-box&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;search-input&quot;</span> <span class="attr">class</span>=<span class="string">&quot;hidden&quot;</span>  <span class="attr">placeholder</span>=<span class="string">&quot;Search&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;clear-btn&quot;</span> <span class="attr">class</span>=<span class="string">&quot;hidden&quot;</span>&gt;</span></span><br><span class="line">          &lt;%- partial(&#x27;_icon/clear&#x27;) %&gt;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;search-btn&quot;</span> <span class="attr">class</span>=<span class="string">&quot;nav-icon&quot;</span>&gt;</span></span><br><span class="line">      &lt;%- partial(&#x27;_icon/search&#x27;) %&gt;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">navbar</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;search-result&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><h1 id="some-JavaScript"><a href="#some-JavaScript" class="headerlink" title="some JavaScript"></a>some JavaScript</h1><h2 id="搜尋功能"><a href="#搜尋功能" class="headerlink" title="搜尋功能"></a>搜尋功能</h2><p>搜尋功能裡最重要的就是搜尋功能 (?)</p><p>解釋一下原理 :<br>首先會用到 hexo 的一個插件 <a href="https://github.com/wzpan/hexo-generator-search">hexo-generator-search</a>，這個插件會幫你把所有的 post 做 index 然後產生一個 <code>search.xml</code>，接著我們就可以對這個 <code>search.xml</code> 來做搜尋藉此找到我們要的 post。</p><p>搜尋部分的程式碼是用<a href="https://liam.page/2017/09/21/local-search-engine-in-Hexo-site/">別人的程式碼</a>(因為我很爛)，再做一些小修改。<br>由於很長我就不把程式貼在這了，很醜。大致上就是在 <code>search.xml</code> 裡面找關鍵字，然後標記起來，並用 <code>li</code> 元素將每個結果包起來，最後回傳一個 <code>ul</code> 清單讓我們可以放在 <code>search-result</code> 裡面。</p><h2 id="按鈕功能"><a href="#按鈕功能" class="headerlink" title="按鈕功能"></a>按鈕功能</h2><p>接著是清除按鈕的功能，這部分其實是包含在搜尋功能的程式碼裡面，片段如下 :</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="variable language_">document</span>).<span class="title function_">on</span>(<span class="string">&#x27;click&#x27;</span>, <span class="string">&#x27;#clear-btn&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    $(<span class="string">&#x27;#search-input&#x27;</span>).<span class="title function_">val</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    $(<span class="string">&#x27;#search-result&#x27;</span>).<span class="title function_">html</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>然後是搜尋按鈕，上面章節有提到，這個按鈕其實沒有搜尋功能。因為在使用者輸入時我們就會直接輸出搜尋結果，不需要再多按一個搜尋按鈕，於是這個按鈕的功能就變成單單讓搜尋框出現和收起，也就是為它們加上或去除 <code>class = &quot;hidden&quot;</code>。<br>程式碼如下 :</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;DOMContentLoaded&quot;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> searchButton = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;search-btn&quot;</span>);</span><br><span class="line">  <span class="keyword">var</span> clearButton = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;clear-btn&quot;</span>);</span><br><span class="line">  <span class="keyword">var</span> searchInput = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;search-input&quot;</span>);</span><br><span class="line"></span><br><span class="line">  searchButton.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    clearButton.<span class="property">classList</span>.<span class="title function_">toggle</span>(<span class="string">&quot;hidden&quot;</span>);</span><br><span class="line">    searchInput.<span class="property">classList</span>.<span class="title function_">toggle</span>(<span class="string">&quot;hidden&quot;</span>);</span><br><span class="line">    <span class="comment">// 順便把搜尋結果清掉</span></span><br><span class="line">    $(<span class="string">&#x27;#search-input&#x27;</span>).<span class="title function_">val</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    $(<span class="string">&#x27;#search-result&#x27;</span>).<span class="title function_">html</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><hr><h1 id="some-CSS"><a href="#some-CSS" class="headerlink" title="some CSS"></a>some CSS</h1><p>對我個人而言，用起來要賞心悅目才爽，因此 css 是非常重要的；另一方面，也要用 css 才能讓搜尋框順利隱藏。<br>由於 css 的屬性很多，細節可以看 <a href="https://developer.mozilla.org/en-US/docs/Web/CSS">MDN DOCS</a> 會更詳細，因此這部分只會提到幾個關鍵的屬性。</p><h2 id="搜尋結果"><a href="#搜尋結果" class="headerlink" title="搜尋結果"></a>搜尋結果</h2><p>搜尋結果會以 ul 清單的方式呈現，想讓每個結果以垂直並列的方式呈現可以使用 flex 布局 :</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">display</span>: flex</span><br><span class="line"><span class="attribute">flex-direction</span>: column</span><br></pre></td></tr></table></figure><p>然後，我不想讓這個清單無限伸長，我希望可以讓搜尋結果超出特定長度時可以出現滾動條，因此加上這兩個屬性 :</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">overflow-y</span>: scroll</span><br><span class="line"><span class="attribute">overflow-x</span>: hidden</span><br></pre></td></tr></table></figure><p>同時，ul 和 li 元素都設有 <code>maxwidth</code> 來限制最大高度。</p><h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><p>剩下的元素其實就是根據網站主題來更改 css 樣式，讓它不要顯得太突兀。<br>而所有元素都是採用 flex 布局，因為它可以自動幫我們調整寬高，我就不用做自適應了，好耶。</p>]]></content>
      
      
      <categories>
          
          <category> Blog </category>
          
      </categories>
      
      
        <tags>
            
            <tag> guide </tag>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TOC test</title>
      <link href="/2023/11/17/toc-test/"/>
      <url>/2023/11/17/toc-test/</url>
      
        <content type="html"><![CDATA[<h1 id="header-1-1"><a href="#header-1-1" class="headerlink" title="header 1.1"></a>header 1.1</h1><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus ut nisl a nisl scelerisque tempor nec et libero. Curabitur ut risus auctor neque volutpat porta. Curabitur vitae pretium tellus. Phasellus pulvinar ex justo, vitae luctus ipsum pharetra quis. Morbi ornare justo eu urna posuere porttitor. Fusce finibus vel odio sed convallis. Nulla vel eros blandit, molestie orci et, aliquam ligula. In pretium laoreet erat nec mattis. Proin porta pellentesque ante, eu gravida arcu vestibulum ut. Curabitur at mattis justo, ac vestibulum risus. Nulla laoreet et massa at euismod. Proin convallis rhoncus aliquam.<br>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus ut nisl a nisl scelerisque tempor nec et libero. Curabitur ut risus auctor neque volutpat porta. Curabitur vitae pretium tellus. Phasellus pulvinar ex justo, vitae luctus ipsum pharetra quis. Morbi ornare justo eu urna posuere porttitor. Fusce finibus vel odio sed convallis. Nulla vel eros blandit, molestie orci et, aliquam ligula. In pretium laoreet erat nec mattis. Proin porta pellentesque ante, eu gravida arcu vestibulum ut. Curabitur at mattis justo, ac vestibulum risus. Nulla laoreet et massa at euismod. Proin convallis rhoncus aliquam.</p><h2 id="header-2-1"><a href="#header-2-1" class="headerlink" title="header 2.1"></a>header 2.1</h2><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus ut nisl a nisl scelerisque tempor nec et libero. Curabitur ut risus auctor neque volutpat porta. Curabitur vitae pretium tellus. Phasellus pulvinar ex justo, vitae luctus ipsum pharetra quis. Morbi ornare justo eu urna posuere porttitor. Fusce finibus vel odio sed convallis. Nulla vel eros blandit, molestie orci et, aliquam ligula. In pretium laoreet erat nec mattis. Proin porta pellentesque ante, eu gravida arcu vestibulum ut. Curabitur at mattis justo, ac vestibulum risus. Nulla laoreet et massa at euismod. Proin convallis rhoncus aliquam.</p><h2 id="header-2-2"><a href="#header-2-2" class="headerlink" title="header 2.2"></a>header 2.2</h2><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus ut nisl a nisl scelerisque tempor nec et libero. Curabitur ut risus auctor neque volutpat porta. Curabitur vitae pretium tellus. Phasellus pulvinar ex justo, vitae luctus ipsum pharetra quis. Morbi ornare justo eu urna posuere porttitor. Fusce finibus vel odio sed convallis. Nulla vel eros blandit, molestie orci et, aliquam ligula. In pretium laoreet erat nec mattis. Proin porta pellentesque ante, eu gravida arcu vestibulum ut. Curabitur at mattis justo, ac vestibulum risus. Nulla laoreet et massa at euismod. Proin convallis rhoncus aliquam.</p><h1 id="header-1-2"><a href="#header-1-2" class="headerlink" title="header 1.2"></a>header 1.2</h1><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus ut nisl a nisl scelerisque tempor nec et libero. Curabitur ut risus auctor neque volutpat porta. Curabitur vitae pretium tellus. Phasellus pulvinar ex justo, vitae luctus ipsum pharetra quis. Morbi ornare justo eu urna posuere porttitor. Fusce finibus vel odio sed convallis. Nulla vel eros blandit, molestie orci et, aliquam ligula. In pretium laoreet erat nec mattis. Proin porta pellentesque ante, eu gravida arcu vestibulum ut. Curabitur at mattis justo, ac vestibulum risus. Nulla laoreet et massa at euismod. Proin convallis rhoncus aliquam.</p><h3 id="header-3-1"><a href="#header-3-1" class="headerlink" title="header 3.1"></a>header 3.1</h3><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus ut nisl a nisl scelerisque tempor nec et libero. Curabitur ut risus auctor neque volutpat porta. Curabitur vitae pretium tellus. Phasellus pulvinar ex justo, vitae luctus ipsum pharetra quis. Morbi ornare justo eu urna posuere porttitor. Fusce finibus vel odio sed convallis. Nulla vel eros blandit, molestie orci et, aliquam ligula. In pretium laoreet erat nec mattis. Proin porta pellentesque ante, eu gravida arcu vestibulum ut. Curabitur at mattis justo, ac vestibulum risus. Nulla laoreet et massa at euismod. Proin convallis rhoncus aliquam.</p><h1 id="header-1-3"><a href="#header-1-3" class="headerlink" title="header 1.3"></a>header 1.3</h1><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus ut nisl a nisl scelerisque tempor nec et libero. Curabitur ut risus auctor neque volutpat porta. Curabitur vitae pretium tellus. Phasellus pulvinar ex justo, vitae luctus ipsum pharetra quis. Morbi ornare justo eu urna posuere porttitor. Fusce finibus vel odio sed convallis. Nulla vel eros blandit, molestie orci et, aliquam ligula. In pretium laoreet erat nec mattis. Proin porta pellentesque ante, eu gravida arcu vestibulum ut. Curabitur at mattis justo, ac vestibulum risus. Nulla laoreet et massa at euismod. Proin convallis rhoncus aliquam.</p><h2 id="header-2-1-1"><a href="#header-2-1-1" class="headerlink" title="header 2.1"></a>header 2.1</h2><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus ut nisl a nisl scelerisque tempor nec et libero. Curabitur ut risus auctor neque volutpat porta. Curabitur vitae pretium tellus. Phasellus pulvinar ex justo, vitae luctus ipsum pharetra quis. Morbi ornare justo eu urna posuere porttitor. Fusce finibus vel odio sed convallis. Nulla vel eros blandit, molestie orci et, aliquam ligula. In pretium laoreet erat nec mattis. Proin porta pellentesque ante, eu gravida arcu vestibulum ut. Curabitur at mattis justo, ac vestibulum risus. Nulla laoreet et massa at euismod. Proin convallis rhoncus aliquam.</p><h3 id="header-3-1-1"><a href="#header-3-1-1" class="headerlink" title="header 3.1"></a>header 3.1</h3><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus ut nisl a nisl scelerisque tempor nec et libero. Curabitur ut risus auctor neque volutpat porta. Curabitur vitae pretium tellus. Phasellus pulvinar ex justo, vitae luctus ipsum pharetra quis. Morbi ornare justo eu urna posuere porttitor. Fusce finibus vel odio sed convallis. Nulla vel eros blandit, molestie orci et, aliquam ligula. In pretium laoreet erat nec mattis. Proin porta pellentesque ante, eu gravida arcu vestibulum ut. Curabitur at mattis justo, ac vestibulum risus. Nulla laoreet et massa at euismod. Proin convallis rhoncus aliquam.</p><h2 id="header-2-2-1"><a href="#header-2-2-1" class="headerlink" title="header 2.2"></a>header 2.2</h2><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus ut nisl a nisl scelerisque tempor nec et libero. Curabitur ut risus auctor neque volutpat porta. Curabitur vitae pretium tellus. Phasellus pulvinar ex justo, vitae luctus ipsum pharetra quis. Morbi ornare justo eu urna posuere porttitor. Fusce finibus vel odio sed convallis. Nulla vel eros blandit, molestie orci et, aliquam ligula. In pretium laoreet erat nec mattis. Proin porta pellentesque ante, eu gravida arcu vestibulum ut. Curabitur at mattis justo, ac vestibulum risus. Nulla laoreet et massa at euismod. Proin convallis rhoncus aliquam.</p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
